<!DOCTYPE html>
<html>
<head>
    <title>{{.Title}} - USL Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #007cba;
            padding-bottom: 10px;
        }
        .nav-links {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .nav-link {
            background-color: #007cba;
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .nav-link:hover {
            background-color: #005a87;
        }
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-section h3 {
            margin-top: 0;
            color: #007cba;
            border-bottom: 2px solid #007cba;
            padding-bottom: 8px;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        .form-group.full-width {
            flex: 100%;
        }
        .form-group.half-width {
            flex: 0 0 calc(50% - 10px);
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
            font-size: 12px;
        }
        .required {
            color: #dc3545;
        }
        input[type="text"],
        input[type="number"],
        input[type="url"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="url"]:focus {
            border-color: #007cba;
            outline: none;
            box-shadow: 0 0 5px rgba(0,124,186,0.3);
        }
        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 10px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #007cba;
            color: white;
        }
        .btn-primary:hover {
            background-color: #005a87;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .help-text {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
        .info-section {
            background-color: #e7f3ff;
            border-left: 4px solid #007cba;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-section h3 {
            margin-top: 0;
            color: #007cba;
        }
        .info-section ul {
            margin-bottom: 0;
            font-size: 14px;
        }
        .playlist-header {
            background-color: #007cba;
            color: white;
            text-align: center;
            padding: 10px;
            margin: 15px 0 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .user-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
        }
        .user-select:focus {
            border-color: #007cba;
            outline: none;
            box-shadow: 0 0 5px rgba(0,124,186,0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .auto-fill-section {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
        }
        .auto-fill-section h3 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{.Title}}</h1>
        
        <div class="nav-links">
            <a href="/usl/admin" class="nav-link">‚Üê Back to Dashboard</a>
            <a href="/usl/trackers" class="nav-link">View All Trackers</a>
        </div>

        <div class="info-section">
            <h3>Adding New USL Tracker</h3>
            <ul>
                <li>Tracker URL should be a valid Rocket League tracker link (e.g., tracker.gg)</li>
                <li>Discord ID must match an existing USL user</li>
                <li>All playlist statistics are optional - enter what's available</li>
                <li>MMR will be calculated from the highest playlist rank</li>
                <li>Tracker validity is automatically determined</li>
            </ul>
        </div>

        <div class="auto-fill-section">
            <h3>Quick Start</h3>
            <p>If you have a tracker URL, paste it below and we'll try to populate basic information:</p>
            <div class="form-row">
                <div class="form-group">
                    <label for="quick_url">Tracker URL</label>
                    <input type="url" id="quick_url" placeholder="https://rocketleague.tracker.gg/rocket-league/profile/...">
                    <div class="help-text">We'll extract Discord info if available in the URL</div>
                </div>
                <div class="form-group" style="display: flex; align-items: end;">
                    <button type="button" id="parse_url_btn" class="btn btn-secondary">Parse URL</button>
                </div>
            </div>
        </div>

        <form method="POST" action="/usl/trackers/create">
            <div class="form-section">
                <h3>Basic Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="discord_id">USL User <span class="required">*</span></label>
                        <select id="discord_id" name="discord_id" class="user-select" required>
                            <option value="">Select a USL user...</option>
                            {{range .Users}}
                            <option value="{{.DiscordID}}">{{.Name}} ({{.DiscordID}})</option>
                            {{end}}
                        </select>
                        <div class="help-text">Choose the USL user this tracker belongs to</div>
                    </div>
                    <div class="form-group">
                        <label for="url">Tracker URL <span class="required">*</span></label>
                        <input type="url" id="url" name="url" required 
                               placeholder="https://rocketleague.tracker.gg/rocket-league/profile/...">
                        <div class="help-text">Full URL to the player's tracker profile</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mmr">Overall MMR</label>
                        <input type="number" id="mmr" name="mmr" 
                               placeholder="Enter overall MMR" min="0" max="3000">
                        <div class="help-text">Overall player rating (calculated automatically if left blank)</div>
                    </div>
                    <div class="form-group">
                        <label>Tracker Status</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="valid" name="valid" value="true" checked>
                                <label for="valid">Valid Tracker</label>
                            </div>
                        </div>
                        <div class="help-text">Uncheck if the tracker data is unreliable</div>
                    </div>
                </div>
            </div>

            <!-- 1v1 Stats -->
            <div class="form-section">
                <div class="playlist-header">1v1 Duel Statistics</div>
                <div class="stats-grid">
                    <div class="form-group">
                        <label for="ones_current_peak">Current Season Peak</label>
                        <input type="number" id="ones_current_peak" name="ones_current_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank this season</div>
                    </div>
                    <div class="form-group">
                        <label for="ones_previous_peak">Previous Season Peak</label>
                        <input type="number" id="ones_previous_peak" name="ones_previous_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank last season</div>
                    </div>
                    <div class="form-group">
                        <label for="ones_all_time_peak">All-Time Peak</label>
                        <input type="number" id="ones_all_time_peak" name="ones_all_time_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank ever achieved</div>
                    </div>
                    <div class="form-group">
                        <label for="ones_current_games">Current Season Games</label>
                        <input type="number" id="ones_current_games" name="ones_current_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played this season</div>
                    </div>
                    <div class="form-group">
                        <label for="ones_previous_games">Previous Season Games</label>
                        <input type="number" id="ones_previous_games" name="ones_previous_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played last season</div>
                    </div>
                </div>
            </div>

            <!-- 2v2 Stats -->
            <div class="form-section">
                <div class="playlist-header">2v2 Doubles Statistics</div>
                <div class="stats-grid">
                    <div class="form-group">
                        <label for="twos_current_peak">Current Season Peak</label>
                        <input type="number" id="twos_current_peak" name="twos_current_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank this season</div>
                    </div>
                    <div class="form-group">
                        <label for="twos_previous_peak">Previous Season Peak</label>
                        <input type="number" id="twos_previous_peak" name="twos_previous_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank last season</div>
                    </div>
                    <div class="form-group">
                        <label for="twos_all_time_peak">All-Time Peak</label>
                        <input type="number" id="twos_all_time_peak" name="twos_all_time_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank ever achieved</div>
                    </div>
                    <div class="form-group">
                        <label for="twos_current_games">Current Season Games</label>
                        <input type="number" id="twos_current_games" name="twos_current_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played this season</div>
                    </div>
                    <div class="form-group">
                        <label for="twos_previous_games">Previous Season Games</label>
                        <input type="number" id="twos_previous_games" name="twos_previous_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played last season</div>
                    </div>
                </div>
            </div>

            <!-- 3v3 Stats -->
            <div class="form-section">
                <div class="playlist-header">3v3 Standard Statistics</div>
                <div class="stats-grid">
                    <div class="form-group">
                        <label for="threes_current_peak">Current Season Peak</label>
                        <input type="number" id="threes_current_peak" name="threes_current_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank this season</div>
                    </div>
                    <div class="form-group">
                        <label for="threes_previous_peak">Previous Season Peak</label>
                        <input type="number" id="threes_previous_peak" name="threes_previous_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank last season</div>
                    </div>
                    <div class="form-group">
                        <label for="threes_all_time_peak">All-Time Peak</label>
                        <input type="number" id="threes_all_time_peak" name="threes_all_time_peak" 
                               placeholder="MMR" min="0" max="3000">
                        <div class="help-text">Highest rank ever achieved</div>
                    </div>
                    <div class="form-group">
                        <label for="threes_current_games">Current Season Games</label>
                        <input type="number" id="threes_current_games" name="threes_current_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played this season</div>
                    </div>
                    <div class="form-group">
                        <label for="threes_previous_games">Previous Season Games</label>
                        <input type="number" id="threes_previous_games" name="threes_previous_games" 
                               placeholder="Games" min="0" max="10000">
                        <div class="help-text">Games played last season</div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <a href="/usl/trackers" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Create Tracker</button>
            </div>
        </form>
    </div>

    <script>
        // URL parsing functionality
        document.getElementById('parse_url_btn').addEventListener('click', function() {
            const quickUrl = document.getElementById('quick_url').value;
            if (quickUrl) {
                // Copy URL to main field
                document.getElementById('url').value = quickUrl;
                
                // Try to extract platform info from URL patterns
                // This is a basic implementation - could be enhanced
                if (quickUrl.includes('steam') || quickUrl.includes('76561')) {
                    // Steam URL detected
                    console.log('Steam profile detected');
                }
            }
        });

        // Calculate overall MMR from playlist peaks
        function calculateMMR() {
            const peaks = [
                parseInt(document.getElementById('ones_current_peak').value) || 0,
                parseInt(document.getElementById('twos_current_peak').value) || 0,
                parseInt(document.getElementById('threes_current_peak').value) || 0
            ];
            
            const maxPeak = Math.max(...peaks);
            if (maxPeak > 0 && !document.getElementById('mmr').value) {
                document.getElementById('mmr').value = maxPeak;
            }
        }

        // Auto-calculate MMR when peak values change
        ['ones_current_peak', 'twos_current_peak', 'threes_current_peak'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateMMR);
        });

        // URL validation
        document.getElementById('url').addEventListener('input', function() {
            const value = this.value;
            try {
                if (value && !value.startsWith('http')) {
                    this.style.borderColor = '#dc3545';
                } else if (value) {
                    new URL(value); // Will throw if invalid
                    this.style.borderColor = '#28a745';
                } else {
                    this.style.borderColor = '#ddd';
                }
            } catch (e) {
                this.style.borderColor = '#dc3545';
            }
        });

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const discordId = document.getElementById('discord_id').value;
            const url = document.getElementById('url').value;
            
            if (!discordId || !url) {
                e.preventDefault();
                alert('Please select a USL user and provide a tracker URL.');
                return;
            }

            // Check if at least some stats are provided
            const hasStats = ['ones_current_peak', 'twos_current_peak', 'threes_current_peak',
                             'ones_current_games', 'twos_current_games', 'threes_current_games']
                .some(id => document.getElementById(id).value);
            
            if (!hasStats) {
                const confirm = window.confirm('No statistics were entered. Create tracker anyway?');
                if (!confirm) {
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>